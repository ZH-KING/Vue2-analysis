{"version":3,"file":"vue.js","sources":["../src/compiler/generate.js","../src/compiler/parse.js","../src/compiler/index.js","../src/utils/index.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-09 13:58:03\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-09 16:44:25\r\n * @FilePath: \\vue2-rollup\\src\\compiler\\generate.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配花括号 {{  }}；捕获花括号里面的内容\r\n\r\nfunction genProps(attrs){\r\n    let str = ''\r\n    for(let i=0;i<attrs.length;i++){\r\n        let attr = attrs[i]\r\n        // 如果属性为 style 时，转化为 style:{a:b,c:d} 格式\r\n        if(attr.name === 'style'){\r\n            let obj = {}\r\n            attr.value.split(\";\").forEach(item => {\r\n                let [key, value] = item.split(\":\");\r\n                obj[key] = value\r\n            });\r\n            attr.value = obj\r\n        }\r\n        // 结果变为 a:b,c:d,...\r\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n        \r\n    }\r\n    // 删掉多余的逗号\r\n    return `{${str.slice(0,-1)}}`\r\n}\r\n\r\nfunction gen(node){\r\n    if(node.type === 1){\r\n        return codegen(node)\r\n    }else{\r\n        // 如果是纯文本\r\n        let text = node.text;\r\n        if(!defaultTagRE.test(text)){\r\n            return `_v(${JSON.stringify(text)})`\r\n        }else{\r\n            let tokens = [];\r\n            let match,index;\r\n            // 正则是全局模式 每次需要重置正则的lastIndex属性，不然会引发匹配bug（defaultTagRE.exec()匹配完一次后，再次匹配为null，需要重置lastIndex）\r\n            defaultTagRE.lastIndex = 0;\r\n            let lastIndex = 0;\r\n            while(match = defaultTagRE.exec(text)){\r\n                // 匹配的位置\r\n                index = match.index;\r\n                // 放入文本值  {{name}}  hello {{age}}  取hello放入tokens\r\n                if(index > lastIndex){\r\n                    tokens.push(JSON.stringify(text.slice(lastIndex, index)))\r\n                }\r\n                // tokens中放入变量\r\n                tokens.push(`_s(${match[1].trim()})`)\r\n                // 记录 }} 结束的位置\r\n                lastIndex = index + match[0].length\r\n            }\r\n            // 如果匹配完了花括号，text里面还有剩余的普通文本，那么继续push到tokens\r\n            if(lastIndex < text.length){\r\n                tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n            }\r\n            return `_v(${tokens.join(\"+\")})`\r\n        }\r\n    }\r\n}\r\n\r\nfunction genChildren(children){\r\n    if(children){\r\n        return children.map(child=>gen(child)).join(\",\")\r\n    }\r\n}\r\n\r\nexport function codegen(ast){\r\n    let children = genChildren(ast.children)\r\n    let code = `_c('${ast.tag}',${ast.attrs.length > 0 ? genProps(ast.attrs) : null\r\n    }${ast.children.length > 0 ? `,${children}` : ''\r\n    })`\r\n    return code\r\n}","// 以下为vue源码的正则\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; //匹配标签名；形如 abc-123\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //匹配特殊标签;形如 abc:234,前面的abc:可有可无；获取标签名；\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 匹配标签开头；形如  <  ；捕获里面的标签名\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结尾，形如 >、/>\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配结束标签 如 </abc-123> 捕获里面的标签名\r\nconst attribute =\r\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性  形如 id=\"app\"\r\n\r\nexport function parseHTML(template){\r\n\r\n    const ELEMENT_TYPE = 1;\r\n    const TEXT_TYPE = 3;\r\n    const stack = []; // 用于存放元素\r\n    let currentParent; // 指向的是栈中的最后一个\r\n    let root;\r\n\r\n    // 最终需要转化成一颗抽象语法树\r\n    function createASTElement(tag, attrs){\r\n        return {\r\n            tag,\r\n            type: ELEMENT_TYPE,\r\n            children: [],\r\n            attrs,\r\n            parent: null\r\n        }\r\n    }\r\n    \r\n    function start(tagName, attrs){\r\n        let node = createASTElement(tagName, attrs)\r\n        // 如果没有根元素，那么当前元素为根元素\r\n        if(!root){\r\n            root = node;\r\n        }\r\n        // 给当前节点绑定父子关系\r\n        if(currentParent){\r\n            node.parent = currentParent;\r\n            currentParent.children.push(node)\r\n        }\r\n        // 将当前元素放入栈中\r\n        stack.push(node);\r\n        // 当前currentParent为当前节点\r\n        currentParent = node\r\n    }\r\n\r\n    function chars(text){\r\n        text = text.replace(/\\s/g, '')\r\n        // 文本直接放到当前指向的节点中\r\n        if(text){\r\n            currentParent.children.push({\r\n                type: TEXT_TYPE,\r\n                text,\r\n                parent: currentParent\r\n            })\r\n        }\r\n    }\r\n    function end(tagName){\r\n        // 处理到结束标签时，将该元素从栈中移出\r\n        let node = stack.pop()\r\n        // 此时currentParent为stack中的上一个元素\r\n        currentParent = stack[stack.length - 1]\r\n    }\r\n    // 截取 template 字符串，每次匹配到了就截掉\r\n    function advance(n){\r\n        template = template.substring(n)\r\n    }\r\n    // 解析开始标签\r\n    function parseStartTag(){\r\n        // 匹配开始标签\r\n        const start = template.match(startTagOpen)\r\n        // start 格式为：['<div', 'div', index: 0, groups: undefined, input: '<div id=\\\"app\\\">']\r\n        if(start){\r\n            const match = {\r\n                tagName: start[1], // 标签名\r\n                attrs: []\r\n            }\r\n            advance(start[0].length)\r\n\r\n            // 如果不是开始标签的结束，就一直匹配下去\r\n            // attr 格式为：[\"class=\\\"myClass\\\"\", \"class\", \"=\", \"myClass\", undefined, undefined]\r\n            let attr,end;\r\n            while(!(end = template.match(startTagClose)) && (attr = template.match(attribute))){\r\n                advance(attr[0].length)\r\n                match.attrs.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5]\r\n                })\r\n            }\r\n            if(end){\r\n                advance(end[0].length)   \r\n            }\r\n            return match\r\n        }\r\n        \r\n        return false;\r\n    }\r\n    /**\r\n     * 递归解析template，进行初步处理\r\n     * 解析开始标签，将结果 {tagName, attrs} 交给handleStartTag函数处理\r\n     * 解析结束标签，将结果 tagName 交给 handleEndTag 函数处理\r\n     * 解析文本类型，将结果 text 交给 handleChars 函数处理\r\n     */\r\n    while(template){\r\n        // 查找 < 的位置，根据它的位置判断第一个元素是什么标签\r\n        let textEnd = template.indexOf(\"<\")\r\n        // 第一个元素为 '<' 时，即碰到开始/结束标签\r\n        if(textEnd === 0){\r\n            // 匹配到开始标签 例如：<div>\r\n            const startTagMatch = parseStartTag()\r\n            if(startTagMatch){\r\n                start(startTagMatch.tagName, startTagMatch.attrs)\r\n                continue\r\n            }\r\n            // 匹配到结束标签 例如：</div>\r\n            const endTagMatch = template.match(endTag)\r\n            if(endTagMatch){\r\n                end(endTagMatch[1])\r\n                advance(endTagMatch[0].length)\r\n                continue\r\n            }\r\n        }\r\n        // 第一个元素为文本时\r\n        if(textEnd > 0){\r\n            let text = template.substring(0,textEnd)\r\n            if(text){\r\n                chars(text)\r\n                advance(text.length)\r\n            }\r\n        }\r\n    }\r\n    return root;\r\n}","/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-08 14:54:51\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-09 16:47:49\r\n * @FilePath: \\vue2-rollup\\src\\compiler\\index.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\nimport { codegen } from \"./generate\";\r\nimport { parseHTML } from \"./parse\";\r\n\r\nexport function compileToFunction(template){\r\n\r\n    // 1、将template转成AST语法树：AST用来描述代码本身形成树结构，不仅可以描述html，也能描述css以及js语法\r\n    let ast = parseHTML(template);\r\n    /**\r\n     * 2、通过AST，重新生成代码\r\n     * 生成的代码需要跟render函数一样\r\n     * 类似 _c('div',{id: \"app\"},_c('div',undefined,_v(_s(name)),_c('span',undefined,_v(_s(age))))\r\n     * _c代表创建元素 _v代表创建文本 _s代表变量\r\n     */\r\n\r\n    let code = codegen(ast)\r\n    // 模板引擎的实现原理就是 with + new Function\r\n    code = `with(this){return ${code}}`\r\n    let render = new Function(code)\r\n    return render\r\n}\r\n","/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-07 16:56:24\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-07 17:14:13\r\n * @FilePath: \\vue2-rollup\\src\\utils\\index.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\nexport function isFunction(val){\r\n    return typeof val === 'function';\r\n}\r\nexport function isObject(val){\r\n    return typeof val === 'object';\r\n}","/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-08 13:40:22\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-08 14:19:28\r\n * @FilePath: \\vue2-rollup\\src\\observe\\array.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\n// 获取数组原型\r\nlet oldArrayProto = Array.prototype;\r\n// newArrayProto.__proto__ = oldArrayProto\r\nexport let newArrayProto = Object.create(oldArrayProto)\r\n\r\nlet methods = [\r\n    \"push\",\r\n    \"pop\",\r\n    \"shift\",\r\n    \"unshift\",\r\n    \"sort\",\r\n    \"reverse\",\r\n    \"splice\"\r\n]\r\n\r\nmethods.forEach(method=>{\r\n    // 重写数组方法\r\n    newArrayProto[method] = function(...args){\r\n        // 调用原数组方法，切片编程\r\n        const result = oldArrayProto[method].call(this, ...args)\r\n\r\n        // 对新增的数据进行劫持\r\n        let inserted;\r\n        let ob = this.__ob__;\r\n        switch(method){\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n            default: \r\n                break;\r\n        }\r\n        // 对新增的数据进行观测\r\n        if(inserted){\r\n            ob.observeArray(inserted)\r\n        }\r\n        console.log(\"method\", ob)\r\n        return result\r\n    }\r\n})","/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-07 17:11:23\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-08 14:20:17\r\n * @FilePath: \\vue2-rollup\\src\\observe\\index.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\n\r\nimport { isObject } from \"../utils/index\";\r\nimport { newArrayProto } from \"./array\";\r\n\r\nclass Observer{\r\n    constructor(data){\r\n        // 将__ob__变成不可枚举（循环的时候无法获取）\r\n        Object.defineProperty(data, '__ob__', {\r\n            value: this,\r\n            enumerable: false\r\n        })\r\n        // data.__ob__ = this;\r\n        if(Array.isArray(data)){\r\n            // 保留数组原有的特性，并且重写部分方法\r\n            data.__proto__ =  newArrayProto\r\n            this.observeArray(data)\r\n        }else{\r\n            this.walk(data)\r\n        }\r\n    }\r\n    walk(data){\r\n        Object.keys(data).forEach(key=>{\r\n            // 对 data 中的每个属性进行响应式处理\r\n            defineReactive(data, key, data[key])\r\n        })\r\n    }\r\n    observeArray(data){\r\n        data.forEach(item => observe(item))\r\n    }\r\n}\r\n\r\nfunction defineReactive(data, key, value){\r\n    // 对深层次对象进行递归处理\r\n    observe(value)\r\n    // 重写对象，给每个属性添加get和set\r\n    Object.defineProperty(data, key, {\r\n        get(){\r\n            return value\r\n        },\r\n        set(newVal){\r\n            if(newVal === value) return;\r\n            // 对象赋值  重新代理\r\n            observe(newVal)\r\n            value = newVal\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data){\r\n    // 判断data是否返回一个对象，vue要求data return {}\r\n    if(!isObject(data)) return\r\n    // 说明这个对象已经被代理过了\r\n    if(data.__ob__ instanceof Observer){\r\n        return data.__ob__;\r\n    }\r\n    // 返回一个响应式对象\r\n    return new Observer(data)\r\n}","/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-07 16:46:24\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-07 17:27:13\r\n * @FilePath: \\vue2-rollup\\src\\state.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\nimport { observe } from './observe/index';\r\nimport { isFunction } from './utils/index'\r\nexport function initState(vm){\r\n    const opts = vm.$options;\r\n    // 初始化data\r\n    if(opts.data){\r\n        initData(vm)\r\n    }\r\n}\r\n// 初始化data\r\nfunction initData(vm){\r\n    let data = vm.$options.data;\r\n    // 往实例上添加一个 _data 属性，即传入的data\r\n    // vue组件data推荐使用函数，防止数据在组件之间共享\r\n    data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n    // 将vm._data上的数据代理到vm上\r\n    for(let key in data){\r\n        proxy(vm, \"_data\", key)\r\n    }\r\n    // 对数据进行观测\r\n    observe(data)\r\n}\r\n// 代理数据\r\nfunction proxy(vm, source, key){\r\n    Object.defineProperty(vm, key, {\r\n        get(){\r\n            return vm[source][key]\r\n        },\r\n        set(newVal){\r\n            vm[source][key] = newVal\r\n        }\r\n    })\r\n}\r\n","import { compileToFunction } from \"./compiler\";\r\nimport { initState } from \"./state\";\r\n\r\n/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-07 16:39:18\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-09 16:50:17\r\n * @FilePath: \\vue2-rollup\\src\\init.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options){\r\n        const vm = this;\r\n        // 在实例上添加 $options 属性\r\n        vm.$options = options;\r\n        // 初始化状态，包括initProps、initData、initMethod、initComputed、initWatch等\r\n        initState(vm)\r\n        // 挂载数据\r\n        if(options.el){\r\n            vm.$mount(options.el)\r\n        }\r\n    }\r\n    Vue.prototype.$mount = function(el){\r\n        const vm = this;\r\n        const opts = vm.$options;\r\n        el = document.querySelector(el)\r\n        /**\r\n         * 1、把模板转化成render函数\r\n         * 2、执行render函数，生成VNode\r\n         * 3、更新时进行diff\r\n         * 4、产生真实DOM\r\n         */\r\n        // 可以直接在options中写render函数\r\n        // 优先级： render > template > el\r\n        if(!opts.render){\r\n            let template = opts.template\r\n            if(!opts.template && el){\r\n                template = el.outerHTML;\r\n            }\r\n            // 写了 template 就用写了的 template\r\n            if(template){\r\n                // 将 template转化成render函数\r\n                const render = compileToFunction(template)\r\n                opts.render = render;\r\n            }\r\n        }\r\n        // 组件的挂载\r\n        mountComponent(vm, el)\r\n    }\r\n}\r\n\r\n","/*\r\n * @Author: JLDiao\r\n * @Date: 2022-09-07 16:11:59\r\n * @LastEditors: ***\r\n * @LastEditTime: 2022-09-09 16:54:58\r\n * @FilePath: \\vue2-rollup\\src\\index.js\r\n * @Description: \r\n * Copyright (c) 2022 by JLDiao, All Rights Reserved. \r\n */\r\n\r\nimport { initMixin } from \"./init\"\r\n\r\n// 创建一个Vue构造函数\r\nfunction Vue(options){\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\ninitLifeCycle(Vue)\r\n\r\nexport default Vue"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","obj","value","split","forEach","item","key","JSON","stringify","slice","gen","node","type","codegen","text","test","tokens","match","index","lastIndex","exec","push","trim","join","genChildren","children","map","child","ast","code","tag","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","attribute","parseHTML","template","ELEMENT_TYPE","TEXT_TYPE","stack","currentParent","root","createASTElement","parent","start","tagName","chars","replace","end","pop","advance","n","substring","parseStartTag","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunction","render","Function","isFunction","val","isObject","oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","method","args","result","call","inserted","ob","__ob__","observeArray","console","log","Observer","data","defineProperty","enumerable","isArray","__proto__","walk","keys","defineReactive","observe","get","set","newVal","initState","vm","opts","$options","initData","_data","proxy","source","initMixin","Vue","_init","options","el","$mount","document","querySelector","outerHTML","mountComponent","initLifeCycle"],"mappings":"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"}